---
title: "GGPLOT2 Tutorial"
author: "Cameron Wimpy"
date: "2019-05-15 (updated: `r Sys.Date()`)"
output:
  rmdformats::readthedown:
    highlight: kate
bibliography: bib.bib 
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

# Introduction

This is a tutorial for using [`R`](https://www.r-project.org/) and [`ggplot2`](https://ggplot2.tidyverse.org) to make publication-ready plots for use in the social science.^[The tidyverse website is a wonderful place to spend your time.] The tutorial assumes moderate familiarity with `R` and base functions. I primarily made this as a learning tool for my POSC 3003/6003 courses at [Arkansas State University](astate.edu). As such, my focus is on applications relevant to political scientists but I suspect this could be of interest to many others interested in `R` graphics. The associated video vignette (for students in my course) on the topic provides additional details and a walkthough every aspect of the code provided here. We will be using built-in (or generated) datasets for this entire document as I want this to remain as self-contained as possible. I hope this document can serve both as a guide for learning `ggplot2` along with some `tidyverse` operations as well as a long-term resource on how to make a given graph. Thanks goes to the many, many folks who have provided their code openly and freely for the rest of us to learn from. All credit goes to them.

I should note that I am far from the best expert on this topic, and there are likely better tutorials out there. It is also worth noting that there are many plot types I will not include. Finally, I will not be covering every single possible aspect of plot customization. In any case, I hope some folks find this useful. If you find issues or have suggestions please hit me up on GitHub [`(@cwimpy)`](https://github.com/cwimpy) or via e-mail. 

I move along in a series of sections. First I introduce `ggplot2` for the one reader that has never heard of it. Then I show a series of examples for getting started along with important features. After that I show how to make a plot look nice before moving into as many examples as I can conjure. I am always adding to this section. Finally, I conclude by showing some extensions and other helpful tips such as exporting plots and using packages written to deal with special `ggplot2` problems.

The source code for this document can be found in my GitHub here: <https://github.com/cwimpy/ggplot2-tutorial>, please also use this if you have suggestions or improvements!

## The Grammar of Graphics

Now let's move on to to learning about `ggplot2`. `ggplot2` is an `R` graphic package developed by [Hadley Wickham](http://hadley.nz) to implement (a layered version) the [grammar of graphics] (http://www.amazon.com/The-Grammar-Graphics-Statistics-Computing/dp/0387245448) system of data visualization proposed by [Leland Wilkinson](https://www.cs.uic.edu/~wilkinson/).^[If you really want to learn about this I suggest buying the respective books from [Wickham](https://www.amazon.com/ggplot2-Elegant-Graphics-Data-Analysis/dp/331924275X/ref=as_li_ss_tl?ie=UTF8&linkCode=sl1&tag=ggplot2-20&linkId=4b4de5146fdafd09b8035e8aa656f300), [Wilkinson](http://www.amazon.com/The-Grammar-Graphics-Statistics-Computing/dp/0387245448), and possibly others (@Wilkinson:2006, @Wickham:2016, @Wickham:2017). The [R for Data Science](https://r4ds.had.co.nz) book is also a great resource. I do not know these authors but highly respect their work (obviously, that's the point of all this!).] The general idea is that all plots should have some basic features that make them interchangeable in the same way, no matter what is being plotted. This of it as a language for reading and writing plots. In practice `ggplot2` has become the gold standard for plotting statistical data in most statistical-heavy disciplines such as bio-statistics, economics, political science, and statistics. The basic `ggplot2` implementation of the grammar of graphics is summarized as follows:

 - a default dataset with aesthetic mappings,
 - one or more layers, each with a geometric object("geom"), a statistical transformation("stat"), and a dataset with aesthetic mappings (possibly defaulted),
 - a scale for each aesthetic mapping (which can be automatically generated),
 - a coordinate system, and
 - a facet specification.
 
 We will tackle the meaning of these items in practical terms as we proceed. The basic idea is that a plot can (perhaps should) be built in layers and should consist of a core set of items in order to adhere to the grammar of graphics. 
 
## Getting Started

We will use the `mtcars` dataset for many of our example plots. Let's have a look at what are in those data. Note that I loaded the `tidyverse` package quietly at the beginning of this document and that it includes `ggplot2` and other tools we will be using throughout (`dplyr`, for example).

```{r mtcars}
glimpse(mtcars)
```

Now we can draw a blank plot where are mapped aesthetics are miles per gallon (`mpg`) and car weight (`wt`). 

```{r plot_blank}
ggplot(mtcars, aes(wt, mpg))
```

Now we can get started with `ggplot()`, the primary (and necessary) engine underlying the `ggplot2` package.

### Aesthetics

Our plot above, created by `ggplot(mtcars, aes(wt, mpg))`, included aesthetic mappings for our two variables car weight and miles per gallon. The mapping provided by `aes(x, y)` is bar far the most important part of aesthetics, but it is also the easiest. In most common use cases of `ggplot2` the `(x, y)` portion of the code simply refers to our `x` and `y` variables—two things we should already know! We will start adding other aesthetics as we move along but these are absolutely key.

### A Note on Coding Style for `ggplot2`

Before moving further, I want to make sure that the code structure is clearly understood. Experienced `R` users (or otherwise experienced programmers) will likely struggle with this far less than I did for the longest time. Let's first look at the core aspects of the `ggplot()` code structure:

```{r code1, eval=FALSE}
ggplot(data = data, mapping = aes(x = x, y = y, ...), ...)
```

The first part of what we see here is the `ggplot()` function itself. The second `data`, `x`, and `y` in this case all refer to those in our data. Inside the outer set of parentheses we first point the plotting function to our data (this needs to be an `R` dataframe that is available in the workspace—or it can be a tibble). This is the first place where we see major variations in code. Some people will leave off the `data = ` part and just type the name of the data object as a shortcut. I do this as well, but it can be confusing for folks new to `ggplot2`. The next block is for mapping our aesthetics. We rarely see the `mapping = ` part of the code, and we can again just shortcut things by using `aes()`. Within the `aes()` parentheses, we then map our `x` and `y` variables by following the same convention. That is, we either say `aes(x = x, y = y)` or simply `aes(x, y)`. Most of the remaining parts of the function typically need to specific, if for nothing else human readability. We will get to those later. 

The next place we see major variation in code is whether folks assign their plot to an object or just run the code outright. This is not a huge distinction for actually making a plot when using well-structured code, but how we read the code certainly changes. Since `R` is an object-oriented programming language we can assign the whole plot to an object just like we can a dataset, variable, function, etc. The best way to see how this works is with an example. Returning to where we were above, we could instead assign our blank plot to an object called "`p`". Why "`p`"? No reason other than it is most commonly used in these cases. You could call it "`plot`", or anything you like as long as it adheres to `R`'s [object naming standards](https://adv-r.hadley.nz/names-values.html#introduction-1) (@Wickham:2019).

```{r plot_p1}
p <- ggplot(mtcars, aes(wt, mpg))
```

Now, using `R`'s object assignment operator, `<-`, we have assigned our plot to the object called "`p`". But notice also that the plot did not automatically return. To get that we need to simply ask `R` for it using the object name.

```{r plot_p2}
p
```

Now, where things get sometimes confusing, and this is jumping ahead, is when folks add additional layers to the plot. If we wanted to see some points on the plot with our initial code above we could do this:

```{r plot_p3}
ggplot(mtcars, aes(wt, mpg)) +
  geom_point()
```

Notice that we do this by adding a `+` (telling `ggplot()` there is a new layer incoming) and then we type the new code. I like to put each new layer on its own line and indent a little after the first line. That helps human readability and allows us to root out bugs in the code. Using the object method we could do something similar. 

```{r plot_p4}
p <- ggplot(mtcars, aes(wt, mpg))
p + geom_point()
```

Can you see any issue with this approach? It does work, but in my mind using the `object +` method is somewhat void of utility (short of some type of exhibition of functionality for vignettes) given that to get the new layer we have to call the object and the new layer together. What if, though, we reassigned the new layer to our object like this?

```{r plot_p5}
p <- ggplot(mtcars, aes(wt, mpg))
p <- p + geom_point()
```

Now, the new `geom_point()` layer is also assigned to `p` and when we call `p` we should get it all:

```{r plot_p6}
p
```

There are uses to this approach, but it needs to be thought through. It makes reading the code a bit more difficult, and all of the assignment operators and plus signs can get busy. Keep in mind that you could also create new objects with each layer should that be useful. We will return to this later when I talk about saving our plots, but that should really only be a final step taken with care. For now, just know that when you see something like `p <- ggplot(...)` you should be able to just return `p` to get to the same place as you would be by using `ggplot(...)` directly.

Finally, with the advent of the so-called pipe (`%>%`) operator from the maggritr package and later `dplyr`, among others, we will sometimes see folks do this:

```{r pipe}
mtcars %>% 
  ggplot(aes(wt, mpg))
```

Indeed, I do this on occasion. Do not be scared off by the code, however, as we are just replacing our ggplot(`data = data`,...) with `data %>% ggplot(...)` and thus it is a simple reordering of the code. Since we cannot work with pipes beyond this in `ggplot` it really just becomes a niche habit and not particularity useful otherwise.^[Note that you need to load a package that uses the pipe in order to use it as `ggplot2` does not load it automatically.]

### Geometric Shapes (`geom`) and Statistical Transformations (`stat`)

Let's get back to how to make plots. Our next step is adding geometric shapes and statistical transformations. We had a glimpse at this earlier, but let's resume with the same plot:

```{r geom_1}
ggplot(mtcars, aes(wt, mpg)) +
  geom_point()
```

In this case, we have asked `ggplot()` to add points to the plot and thus we now have a scatterplot. The "geoms" are numerous, and they are the key to what type of plot you end up with whether it be a bar graph, line graph, histogram, or more. See a list [here](https://ggplot2.tidyverse.org/reference/). Let's add a linear best fit (regression) line to our scatterplot using another geom called `geom_smooth()`.

```{r geom_2}
ggplot(mtcars, aes(wt, mpg)) +
  geom_point() +
  geom_smooth(formula = y ~ x, method = lm)
```

Note that `geom_smooth` needs to know what kind of method we are using and the formula for the calculation of the slope. In this case we are using similar syntax to that of base `R`'s regression model function, `lm`. Our formula simply tells `ggplot()` we want to see the relationship denoted by $y = f(x)$. Notice also that this our first example of layering two geoms on the same plot. This is key to understanding how the `ggplot2` system works. If we want to plot points and labels (see below), we first plot the points and then we add a layer of labels that are relative to the points. We do not plot points and label them at the same time like we would in most other graphic implementations. Once you get this, you will begin to think of your plots as a set of layers that can be added or removed based on your needs. 

What if we instead wanted a horizontal line in the middle of the scatterplot? Note that this type of geom requires that you know the coordinates of the data you are plotting. 

```{r geom_3}
ggplot(mtcars, aes(wt, mpg)) +
  geom_point() +
  geom_abline(intercept = 22.5, slope = 0)
```

Let's look at some other options starting with a bar plot. We will start by looking at the number of cars for each number of possible carburetors.

```{r geom_4}
ggplot(mtcars, aes(carb)) + 
  geom_bar() 
```

We will get back to some more interesting bar plot as this one is akin to a histogram, which we can also easily do since there is a geom for it. Returning to `mpg` 

```{r geom_5}
ggplot(mtcars, aes(mpg)) + 
  geom_histogram(bins = 10) 
```

Relatedly, we can easily make a density plot:

```{r geom_6}
ggplot(mtcars, aes(mpg)) + 
  geom_density() 
```

There are many types of geoms, but hopefully now you are getting an idea of how we use them. We will see quite a few more by the time we are done so for now I want to move on to the next basic building block of a plot. 

### Scales

Scales are used within `ggplot2` to determine how the data being plotted looks to those of us reading the plot. I use scales in two primary ways, one to control the colors of the geoms and the other to format the axes. There are more extensions as well, but let's just focus on these two for now to create an illustrative example. 

```{r}
ggplot(mtcars, aes(wt, mpg, color = carb)) + 
  geom_point() +
  scale_color_continuous()
```

Notice that first I added to our aesthetics by using `color = carb` to say I wanted to color the mapped data by the number of carburetors. I think tell `ggplot()` that we want to treat this as a continuous scale. There are lots of variants to `scale_color_...` and I will cover at least several of them below. The other way in which I use scales is for axis formatting. Since our `x`-axis here is measured in thousands it gives us a nice chance to fix things up. Rather than writing something like (in thousands) in the axis title, we can just build some formatting right into our code. A nifty feature of `ggplot2` is that we can do mathematical operations on variables right in the plotting function. So, I am going to multiply the `wt` variable by `1,000`. 

```{r}
ggplot(mtcars, aes(wt * 1000, mpg, color = carb)) + 
  geom_point() +
  scale_color_continuous()
```

That's much better, and we will work on the axis titles later. We can go further, however, by adding a comma separator. This involves using another package, `scales`, but we will call it using the `::` syntax and thus using `library()` to explicitly load the package is not necessary. 

```{r}
ggplot(mtcars, aes(wt * 1000, mpg, color = carb)) + 
  geom_point() +
  scale_color_continuous() +
  scale_x_continuous(labels = scales::comma)
```

Notice here that our additional line of code was `scale_x_continuous(labels = scales::comma)`. With this we are saying we want to rescale the `x`-axis (we can do `y` as well.) Then, we are using the `labels = ` option to call the comma formatting from the `scales` package. This is another really cool use of `ggplot2` as we can do similar formatting for percents and currency, for example. Those are two places I see folks really mail it in graphing.^[Personally, I am not a fan of using whole numbers and then putting "pct" as an axis title. Even worse is when one uses a decimal and calls it a percentage, but hey, we all have our quirks.]

### Coordinate Systems

You have probably already noticed that `ggplot2` builds graphs on Cartesian coordinates by default, and it explicitly draws a grid of these coordinates thus mapping the `x` and `y` aesthetics quite clearly. We can decide whether we need this level of detail for the coordinates later, but for now it is important to understand a few basics. First and foremost, the default is Cartesian and these can be flipped (using the aptly named `coord_flip()` function) such that `x` and `y` swap places. The most basic example is to use our bar plot from above:

```{r coord_1}
ggplot(mtcars, aes(carb)) + 
  geom_bar() +
  coord_flip()
```

We will get to some nicer examples of flipped plots later, but there is just a bit more to say on coordinates. You can do some basic tweaking of the default coordinates by fixing the aspect ratio (`coord_fixed()`), projecting maps (`coord_map()`), or using `coord_trans()` to do transformations of the coordinates (e.g., logarithms). Finally, all of this may make you wonder how in the world you would make a pie chart using `ggplot2`. The answer from many (and sometimes me) would be that you shouldn't. But, if you must, `coord_polar` is a good place to start.^[`ggforce` has some nice implementations of pie charts, see example in this document.]

### Facets

Facets are essentially a way of paneling your plot based on different categories or levels of variables. Let's return to our scatterplot from above for an example that will make things clear. The difference is that this time we will split the observations into two plots, one for manual transmissions (`1`) and one for automatic (`0`). 

```{r facet_1}
ggplot(mtcars, aes(wt, mpg)) +
  geom_point() +
  geom_smooth(formula = y ~ x, method = lm) +
  facet_wrap(vars(am))
```

There are two types of faceting, `facet_grid()` and `facet_wrap()`. In this case they are essentially equivalent but when we get to more categories below we will see the distinction more clearly. In terms of the syntax, much of the older code you will see would instead have something like this `facet_wrap(.~am)` but the newer versions of the package allow for the cleaner usage of `vars()`. You can facet by multiple variables if you wish, and you can control many things about how the facets look and are organized. We will have more examples below. 

### Making Your Plot Look Good

There are many, many opinions on how plots should look. As such, the style we end up with here will mainly be my own preference. Hopefully between this and the next section I can give you the tools you need to make the plots look as you would like them to. This is also where the library of options within `ggplot2` explodes, so I am certainly not calling this a comprehensive treatment of plot improvement beyond the default.^[Years ago when I was a graduate student you wanted to use the default to show you could use `R` and `ggplot2`. These days, since everyone is doing it, the goal is often to move as far from the default as possible.] 

Virtually everything about a plot can be changed. We will cover the fundamentals but I am sure some things will be left off. Luckily an online search often points you to a [Stack Overflow](https://stackoverflow.com/questions/tagged/ggplot2) thread where someone has experienced a similar issue before. Let's get started with some basics. Most all things we want to change about the look of a plot happens within the `theme()` function, but the main exception is with the labels for the axes, title, subtitle, and caption. These use the `labs` function. Let's see how that works.^[The caption here comes from the [official description](https://stat.ethz.ch/R-manual/R-patched/RHOME/library/datasets/html/mtcars.html) of `mtcars`.] 

```{r labs}
ggplot(mtcars, aes(wt, mpg, color = carb)) +
  geom_point() +
  geom_smooth(formula = y ~ x, method = lm) +
  scale_color_continuous() +
  scale_x_continuous(labels = scales::comma) +
  labs(x = "Car Weight in Pounds", y = "Miles per Gallon", 
       title = "The Relationship Between Car Weight and Miles Per Gallon",
       subtitle = "1974 Data",
       caption = "Note: The data was extracted from the 1974 Motor Trend US magazine, and comprises fuel consumption and 10 aspects of automobile design and performance for 32 automobiles (1973–74 models).")
```

These are fairly easy, just pay attention to the quotation marks and commas. Now, what if we want a better legend title. As with some things in `ggplot2` there are multiple routes to get there. I typically just use `name = ""` inside of the scaling function as follows:

```{r legend_title}
ggplot(mtcars, aes(wt, mpg, color = carb)) +
  geom_point() +
  geom_smooth(formula = y ~ x, method = lm) +
  scale_color_continuous(name = "Carburetors") +
  scale_x_continuous(labels = scales::comma) +
  labs(x = "Car Weight in Pounds", y = "Miles per Gallon", 
       title = "The Relationship Between Car Weight and Miles Per Gallon",
       subtitle = "1974 Data",
       caption = "Note: The data was extracted from the 1974 Motor Trend US magazine, and comprises fuel consumption and 10 aspects of automobile design and performance for 32 automobiles (1973–74 models).")
```

We will deal with many more legend examples as we go along. Before getting into that, however, let me talk about some of the basics in terms of plot styling. As I mentioned above, most of our remaining action here will be inside of the `theme()` function. One of the original hallmarks of `ggplot2` was the grey background in the plotting (panel) area with the white grid lines intersecting on both major and minor grids corresponding with the axis tick labels and halfway between them. That is what we have been seeing so far. Let's start by changing the background to white.

```{r white_background}
ggplot(mtcars, aes(wt, mpg, color = carb)) +
  geom_point() +
  geom_smooth(formula = y ~ x, method = lm) +
  scale_color_continuous(name = "Carburetors") +
  scale_x_continuous(labels = scales::comma) +
  labs(x = "Car Weight in Pounds", y = "Miles per Gallon", 
       title = "The Relationship Between Car Weight and Miles Per Gallon",
       subtitle = "1974 Data",
       caption = "Note: The data was extracted from the 1974 Motor Trend US magazine, and comprises fuel consumption and 10 aspects of automobile design and performance for 32 automobiles (1973–74 models).") +
  theme(panel.background = element_rect(fill = "#FFFFFF"))
```

Notice that I started here with `theme` and then referenced the specific aspect of the theme I wanted to change. `panel.background` refers to the plotting area. `plot.background`, on the other hand, refers to the area outside the plot. For example, we could do this to fill in the plot area with A-State red:

```{r white-red_background}
ggplot(mtcars, aes(wt, mpg, color = carb)) +
  geom_point() +
  geom_smooth(formula = y ~ x, method = lm) +
  scale_color_continuous(name = "Carburetors") +
  scale_x_continuous(labels = scales::comma) +
  labs(x = "Car Weight in Pounds", y = "Miles per Gallon", 
       title = "The Relationship Between Car Weight and Miles Per Gallon",
       subtitle = "1974 Data",
       caption = "Note: The data was extracted from the 1974 Motor Trend US magazine, and comprises fuel consumption and 10 aspects of automobile design and performance for 32 automobiles (1973–74 models).") +
  theme(panel.background = element_rect(fill = "#FFFFFF"), plot.background = element_rect(fill = "#cc092f"))
```

Notice here that I added the additional `theme()` option within the same function, but for clarity you could also just have a series of theme functions each on their own line. In any case, you would want to make your code legible as the options can get lengthy quite quickly. Now, if you ask me, no color at all in the background is the way to roll. That will leave us with a blank (albeit white) canvas for both the plot and panel.

```{r blank_background}
ggplot(mtcars, aes(wt, mpg, color = carb)) +
  geom_point() +
  geom_smooth(formula = y ~ x, method = lm) +
  scale_color_continuous(name = "Carburetors") +
  scale_x_continuous(labels = scales::comma) +
  labs(x = "Car Weight in Pounds", y = "Miles per Gallon", 
       title = "The Relationship Between Car Weight and Miles Per Gallon",
       subtitle = "1974 Data",
       caption = "Note: The data was extracted from the 1974 Motor Trend US magazine, and comprises fuel consumption and 10 aspects of automobile design and performance for 32 automobiles (1973–74 models).") +
  theme(panel.background = element_blank(), 
        plot.background = element_blank())
```

Notice here that we have gone from specifying a color for the rectangle elements (`element_rect()`) to just making those elements blank. This lingo will become clearer the more time you spend with it, so if it is confusing now please just hang around a little longer. I like the grid lines as a default, so let's bring them back in a casual grey but just for the major grids:

```{r grids}
ggplot(mtcars, aes(wt, mpg, color = carb)) +
  geom_point() +
  geom_smooth(formula = y ~ x, method = lm) +
  scale_color_continuous(name = "Carburetors") +
  scale_x_continuous(labels = scales::comma) +
  labs(x = "Car Weight in Pounds", y = "Miles per Gallon", 
       title = "The Relationship Between Car Weight and Miles Per Gallon",
       subtitle = "1974 Data",
       caption = "Note: The data was extracted from the 1974 Motor Trend US magazine, and comprises fuel consumption and 10 aspects of automobile design and performance for 32 automobiles (1973–74 models).") +
  theme(panel.background = element_blank(), 
        plot.background = element_blank(),
        panel.grid.major = element_line(color = "#C4C4C4"))
```

Notice that we used `panel.grid.major` here. As you may suspect, `panel.grid.minor` would take care of those minor lines if we wanted them back. But, what may be less obvious, is that `panel.grid` would handle the major and minor grids together if you so wished. This goes for lots of things in the themes. For example, if we wanted to make our x-axis text as 12 point we would do this: `theme(axis.text.x = element.text(size = 12))`  but we could make all the axis text as 12-point by doing this: `theme(axis.text = element.text(size = 12))`. Again, this same pattern applies to many of the elements for which there are multiple iterations of the same thing. 

But, ugh, now our grid lines conflict with our axis tick colors. We have two options, we could remove the ticks or change the colors (a lame third option would be to leave things as is). I prefer to just remove the ticks in this case:

```{r ticks}
ggplot(mtcars, aes(wt, mpg, color = carb)) +
  geom_point() +
  geom_smooth(formula = y ~ x, method = lm) +
  scale_color_continuous(name = "Carburetors") +
  scale_x_continuous(labels = scales::comma) +
  labs(x = "Car Weight in Pounds", y = "Miles per Gallon", 
       title = "The Relationship Between Car Weight and Miles Per Gallon",
       subtitle = "1974 Data",
       caption = "Note: The data was extracted from the 1974 Motor Trend US magazine, and comprises fuel consumption and 10 aspects of automobile design and performance for 32 automobiles (1973–74 models).") +
  theme(panel.background = element_blank(), 
        plot.background = element_blank(),
        panel.grid.major = element_line(color = "#C4C4C4"),
        axis.ticks = element_blank())
```



#### Themes

In terms of the overall look of the plot, `ggplot2` includes a number of built-in themes. Let's take a look at most of them here.^[For more themes, see the section in this document where I reference the `ggthemes` package. To be really cool, see the section that follows on creating your own theme.]

##### Black & White

```{r theme_bw}
ggplot(mtcars, aes(wt * 1000, mpg, color = carb)) +
  geom_point() +
  geom_smooth(formula = y ~ x, method = lm) +
  scale_color_continuous() +
  scale_x_continuous(labels = scales::comma) + 
  labs(x = "Car Weight in Pounds", y = "Miles per Gallon", 
       title = "The Relationship Between Car Weight and Miles Per Gallon",
       subtitle = "1974 Data",
       caption = "Note: The data was extracted from the 1974 Motor Trend US magazine, and comprises fuel consumption and 10 aspects of automobile design and performance for 32 automobiles (1973–74 models).") +
  theme_bw()
```

##### Classic

```{r theme_classic}
ggplot(mtcars, aes(wt * 1000, mpg, color = carb)) +
  geom_point() +
  geom_smooth(formula = y ~ x, method = lm) +
  scale_color_continuous() +
  scale_x_continuous(labels = scales::comma) + 
  labs(x = "Car Weight in Pounds", y = "Miles per Gallon", 
       title = "The Relationship Between Car Weight and Miles Per Gallon",
       subtitle = "1974 Data",
       caption = "Note: The data was extracted from the 1974 Motor Trend US magazine, and comprises fuel consumption and 10 aspects of automobile design and performance for 32 automobiles (1973–74 models).") +
  theme_classic()
```

##### Dark

```{r theme_dark}
ggplot(mtcars, aes(wt * 1000, mpg, color = carb)) +
  geom_point() +
  geom_smooth(formula = y ~ x, method = lm) +
  scale_color_continuous() +
  scale_x_continuous(labels = scales::comma) + 
  labs(x = "Car Weight in Pounds", y = "Miles per Gallon", 
       title = "The Relationship Between Car Weight and Miles Per Gallon",
       subtitle = "1974 Data",
       caption = "Note: The data was extracted from the 1974 Motor Trend US magazine, and comprises fuel consumption and 10 aspects of automobile design and performance for 32 automobiles (1973–74 models).") +
  theme_dark()
```

##### Light

```{r theme_light}
ggplot(mtcars, aes(wt * 1000, mpg, color = carb)) +
  geom_point() +
  geom_smooth(formula = y ~ x, method = lm) +
  scale_color_continuous() +
  scale_x_continuous(labels = scales::comma) + 
  labs(x = "Car Weight in Pounds", y = "Miles per Gallon", 
       title = "The Relationship Between Car Weight and Miles Per Gallon",
       subtitle = "1974 Data",
       caption = "Note: The data was extracted from the 1974 Motor Trend US magazine, and comprises fuel consumption and 10 aspects of automobile design and performance for 32 automobiles (1973–74 models).") +
  theme_light()
```

##### Linedraw

```{r theme_linedraw}
ggplot(mtcars, aes(wt * 1000, mpg, color = carb)) +
  geom_point() +
  geom_smooth(formula = y ~ x, method = lm) +
  scale_color_continuous() +
  scale_x_continuous(labels = scales::comma) + 
  labs(x = "Car Weight in Pounds", y = "Miles per Gallon", 
       title = "The Relationship Between Car Weight and Miles Per Gallon",
       subtitle = "1974 Data",
       caption = "Note: The data was extracted from the 1974 Motor Trend US magazine, and comprises fuel consumption and 10 aspects of automobile design and performance for 32 automobiles (1973–74 models).") +
  theme_linedraw()
```

##### Minimal

```{r theme_minimal}
ggplot(mtcars, aes(wt * 1000, mpg, color = carb)) +
  geom_point() +
  geom_smooth(formula = y ~ x, method = lm) +
  scale_color_continuous() +
  scale_x_continuous(labels = scales::comma) + 
  labs(x = "Car Weight in Pounds", y = "Miles per Gallon", 
       title = "The Relationship Between Car Weight and Miles Per Gallon",
       subtitle = "1974 Data",
       caption = "Note: The data was extracted from the 1974 Motor Trend US magazine, and comprises fuel consumption and 10 aspects of automobile design and performance for 32 automobiles (1973–74 models).") +
  theme_minimal()
```

##### Void

```{r theme_void}
ggplot(mtcars, aes(wt * 1000, mpg, color = carb)) +
  geom_point() +
  geom_smooth(formula = y ~ x, method = lm) +
  scale_color_continuous() +
  scale_x_continuous(labels = scales::comma) + 
  labs(x = "Car Weight in Pounds", y = "Miles per Gallon", 
       title = "The Relationship Between Car Weight and Miles Per Gallon",
       subtitle = "1974 Data",
       caption = "Note: The data was extracted from the 1974 Motor Trend US magazine, and comprises fuel consumption and 10 aspects of automobile design and performance for 32 automobiles (1973–74 models).") +
  theme_void()
```

## Building Your Own Theme

> The best theme is your own theme. —Cameron Wimpy 

Seriously, I think the best way to really enjoy `ggplot2` is to really take control of how the plot looks. This matters less for exploratory efforts and drafting, but good looking plots can set your work apart in finished products. If we return to all the things we did to our theme earlier, we could actually roll those into our own theme function and thus our tweaks for a given plot would be minor since the new default (using our function) would already look close to how we like it. Notice, inside the `theme()` function below I am just calling a bunch of theme options, some of which you already know.^[Go [here](https://ggplot2.tidyverse.org/reference/theme.html) to see them all.] The rest of what I am doing here is just creating the function. I am overwriting the minimal theme as a starting point and giving you a place to update your fonts. Since fonts can be tricky and are often user/OS-specific, I will let you learn about that separately. But, as an example, I use the "SF Pro Text" font from [Apple](https://developer.apple.com/fonts/). To use this here, I would just replace `"Helvetica"` below with `"SF Pro Text"`.^[Note that you would need to install the font and make sure `R` knows how to find it and that you are using the exact right name. Again, if you are into this sort of thing, I suggest learning about it separate and apart from `ggplot2`.]

```{r theme_final}
theme_cam <- function () {
  theme_minimal(base_size = 10, base_family = "Helvetica") %+replace%
    theme(
      panel.background  = element_blank(),
      panel.border = element_blank(),
      plot.background = element_blank(),
      plot.margin = unit(c(1,2,1,1), "cm"),
      legend.box.background = element_rect(fill = "white", color = NA),
      legend.key = element_rect(fill = NA, color = NA, size = 4),
      legend.text = element_text(color = "black", size = 12),
      legend.title = element_text(color = "black", size = 14),
      legend.position = "bottom",
      legend.direction = "horizontal",
      panel.grid.major = element_line(color = "#C4C4C4"),
      panel.grid.minor = element_blank(),
      axis.text = element_text(color = "black"),
      axis.title = element_text(color = "black", size = 16, angle = 90,
                                  margin = margin(t = 0, r = 10, b = 0, l = 0)),
      plot.title = element_text(size = 20, color = "black", hjust = 0.5,
                                vjust = 2, margin = margin(b = 10)),
      plot.subtitle = element_text(size = 12, color = "black", hjust = 0.5,
                                   margin = margin(b = 12)),
      plot.caption = element_text(size = 8, margin = margin(t = 10), color =
                                    "black", hjust = 0)
    )
}

```

## Example Code for Lots of Plots

In this section I simply make as many plots as I can to provide example code and useful starting points. It is important to again stress that some of these examples are my own takes on other examples provided online by other generous `R`/`ggplot2` users. The credit should certainly go to them. In a few cases I also provide original examples or something from my own work.^[In these cases to fully replicate the plot you will want to fork my repo and get the data.] I expect this section to be the most living part of this document so check back (probably not often) should you be interested in updates. 

## Extensions 

One the most amazing aspects of `ggplot2` is the sheer number of extensions that smart folks have created for it. In and of itself, `ggplot2` solves more plotting problems that most any other plotting package I know of (within `R` or not). When you add the literally dozens of additional extensions (usually prefixed with `gg`) it becomes a tour de force in data visualization. The place to start is the [extensions gallery](http://www.ggplot2-exts.org/gallery/) on the main `ggplot2` website. Some really incredible examples include [`gganimate`](https://gganimate.com) for making animated gifs, [`ggthemes`](https://github.com/jrnold/ggthemes) for some ready-made additional themes (including one that makes your graph look like it was made in default Stata!), [`ggforce`](https://ggforce.data-imaginist.com) for some serious added functionality, and [`ggTimeSeries`](https://github.com/AtherEnergy/ggTimeSeries) for time-specific graphs. There are, of course, many more that are worth exploring. In the few examples that follow I am not showing the code as it the graphs are just proof of concepts mainly from the package vignettes. If you really want to learn these packages I recommend exploring them directly. If you really want the code then it is in the .Rmd document that generate this site.

#### `gganimate`

```{r gganimate, echo=FALSE}
library(gapminder)
library(gganimate)

# Note: This is example code from the package

ggplot(gapminder, aes(gdpPercap, lifeExp, size = pop, colour = country)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  scale_colour_manual(values = country_colors) +
  scale_size(range = c(2, 12)) +
  scale_x_log10() +
  facet_wrap(~continent) +
  # Here comes the gganimate specific bits
  labs(title = 'Year: {frame_time}', x = 'GDP per capita', y = 'life expectancy') +
  transition_time(year) +
  ease_aes('linear')
```

#### `ggthemes`

```{r ggthemes, echo=FALSE}
library(ggthemes)

mtcars %>% 
  ggplot(aes(mpg, wt)) + 
  geom_point() + 
  theme_stata()
```

#### `ggforce`

```{r ggforce, echo=FALSE}
library(ggforce)

# Note: This is example code (slightly modified) from the package

# We'll start by defining some dummy data
pie <- data.frame(
    state = c('eaten', 'eaten but said you didn\'t', 'cat took it', 
              'for tonight', 'will decompose slowly'),
    focus = c(0.2, 0, 0, 0, 0),
    start = c(0, 1, 2, 3, 4),
    end = c(1, 2, 3, 4, 2*pi),
    amount = c(4,3, 1, 1.5, 6),
    stringsAsFactors = FALSE
)

p <- ggplot() + theme_no_axes() + coord_fixed()

# The wedges can be exploded away from the centre using the explode aesthetic
p + geom_arc_bar(aes(x0 = 0, y0 = 0, r0 = 0, r = 1, amount = amount, 
                     fill = state, explode = focus),
                 data = pie, stat = 'pie')
```

#### `ggtimeseries`

```{r ggtimeseries, echo=FALSE}
library(ggTimeSeries)

# Note: This is example code from the package

set.seed(10)
dfData = data.frame(
   Time = 1:1000,
   Signal = abs(
      c(
         cumsum(rnorm(1000, 0, 3)),
         cumsum(rnorm(1000, 0, 4)),
         cumsum(rnorm(1000, 0, 1)),
         cumsum(rnorm(1000, 0, 2))
      )
   ),
   VariableLabel = c(rep('Class A', 1000), rep('Class B', 1000), rep('Class C', 1000), rep('Class D', 1000))
)

# base plot
p1 = ggplot(dfData, aes(x = Time, y = Signal, group = VariableLabel, fill = VariableLabel)) +
  stat_steamgraph()

# adding some formatting
p1 +
   xlab(NULL) +
   ylab(NULL) +
   coord_fixed( 0.2 * diff(range(dfData$Time)) / diff(range(dfData$Signal)))
```

It also warrants mentioning that many packages include `ggplot2` objects in their own flavor of making graphs. The syntax ends up being different in most cases to get started, but the output is a `ggplot2` object that can then be manipulated. One of my favorites in this regard is the [`sjPlot`](https://strengejacke.github.io/sjPlot/) package from [`@strengejacke`](https://github.com/strengejacke) which I use for plotting Likert scales (see my example below). Others include [`urbnmapr`](https://github.com/UrbanInstitute/urbnmapr) from the [Urban Institute](https://www.urban.org) for making easy-peasy U.S. state maps (who wants to do that anyway?), [choroplethr](https://cran.r-project.org/web/packages/choroplethr/index.html) also for maps, and [ggplotly](https://plot.ly/ggplot2/) for interactive graphics.

#### `sjPlot` 

```{r sjPlot, echo=FALSE, message=FALSE, warning=FALSE}
library(sjPlot)
library(sjmisc)
library(haven)

spae.2016 <- read_dta("data/2016_spae.dta")

reforms <- spae.2016 %>% 
  select(starts_with("Q44"), weight) 

color <- c("#329932","#7fbf7f","#ff7f7f", "#ff1919")

items <- c("Vote by internet", 
           "Vote by cell phone", 
           "Vote by mail",  
           "Auto-register at 18", 
           "Election Day registration", 
           "Require voter ID", 
           "Require paper backup", 
           "Election Day on weekend", 
           "Election Day a holiday", 
           "Non-partisan elections", 
           "Auto-register after move"
           )

set_theme(axis.textsize = 10,
  geom.outline.size = 1, 
  geom.label.size = 1.5,
  geom.label.color = "grey10")

p <- find_var(reforms, pattern = "Q44", out = "df") %>% 
  plot_likert(show.n = FALSE, show.prc.sign = TRUE, geom.colors = color, digits = 1, 
              sort.frq = "pos.desc", weight.by = reforms$weight, axis.labels = items) + 
  guides(fill = guide_legend(
    keyheight = unit(2, units = "mm"),
    keywidth = unit(length(labels), units = "mm"),
    nrow = 1,
    reverse = T,
    label.position = "bottom")) + 
  labs(title = "Attitudes Towards Election Reform", subtitle = "SPAE: 2016 Election") + 
  theme_cam() + 
  theme(axis.title = element_text(size = 9), plot.title = element_text(size = 14),
        plot.subtitle = element_text(size = 12), legend.text = element_text(size = 9),
        legend.title = element_text(size = 10), panel.grid = element_blank())
  theme(panel.grid = element_blank(), legend.spacing.x = unit(.1, 'cm')) 
p
```

## Where to Learn More

There are no shortage of other `ggplot2` tutorials available online. Just snoop around until you find one you like via your search engine of choice. There are, however, a few stops I recommend along the way:

 - [The `ggplot2` homepage](https://ggplot2.tidyverse.org)
 - [The `ggplot2` cheatsheet](https://github.com/rstudio/cheatsheets/blob/master/data-visualization-2.1.pdf)
 - [This workshop from Harvard](https://tutorials.iq.harvard.edu/R/Rgraphics/Rgraphics.html)
 - [This guide from <r-statistics.co>](http://r-statistics.co/ggplot2-Tutorial-With-R.html)
 - [This one, too](http://r-statistics.co/Complete-Ggplot2-Tutorial-Part1-With-R-Code.html)
 - [This repo from Jenny Bryan](https://github.com/jennybc/ggplot2-tutorial)
 - [This tutorial from UC Business Analytics](https://uc-r.github.io/ggplot_intro)    
 - [This tutorial from Zev Ross](http://zevross.com/blog/2014/08/04/beautiful-plotting-in-r-a-ggplot2-cheatsheet-3/)
 - [UCLA IDRE](https://stats.idre.ucla.edu/r/seminars/ggplot2_intro/)

## References

